public class Solution {
    private Dictionary<int,int> opt=new Dictionary<int,int>();
    private int[] p;
    public int MaxProfit(int[] prices) {
        
        p=prices;
        
        int max=0;
        for(int i=prices.Length-1;i>=0;i--)
            max=Math.Max(max,dfs(i));
        return max;
    }
    
    private int dfs(int start)
    {
        
        if(start>=p.Length)
            return 0;
        
        if(opt.ContainsKey(start))
            return opt[start];
        //Console.WriteLine("price: "+p[start]);
        int max=0;
        for(int i=start+1;i<p.Length;i++)
        {
            int temp;
            // I can either buy "start", or don't buy it, "i" represents index where i sell start
            if(opt.ContainsKey(i+2))
                temp=opt[i+2];
            else
                temp=0;
            max=Math.Max(max,Math.Max(dfs(i),temp+p[i]-p[start]));
        }
            
        //Console.WriteLine(max);
        opt[start]=max;
        return max;
    }
}
